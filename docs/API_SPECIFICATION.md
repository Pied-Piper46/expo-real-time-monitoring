# Expo API 仕様書

## API エンドポイント

### 1. データ取得API
- **URL**: `https://expo.ebii.net/api/data`
- **メソッド**: GET
- **説明**: 全パビリオンの予約状況データを取得

### 2. 予約追加API
- **URL**: `https://expo.ebii.net/api/add`
- **メソッド**: GET/POST（詳細不明）
- **説明**: 予約処理用（実装詳細は未確認）

## データ構造

### レスポンス形式
```json
[
  {
    "c": "パビリオンコード",
    "n": "パビリオン名（日本語）",
    "u": "パビリオンURL",
    "s": [
      {
        "t": "時間（HHMM形式）",
        "s": "ステータス（数値）"
      }
    ]
  }
]
```

### フィールド詳細

#### パビリオンオブジェクト
- **c** (string): パビリオンコード
  - 例: "H1H9", "HMH0", "I900"
  - ユニークな識別子として使用
- **n** (string): パビリオン名
  - 日本語での正式名称
  - 空文字列の場合もある
- **u** (string): パビリオンURL
  - 公式予約サイトや詳細ページのURL
  - 空文字列の場合もある
- **s** (array): スロット配列
  - 空の場合は営業時間外または予約枠なし

#### スロットオブジェクト（s配列の要素）
- **t** (string): 時間
  - HHMM形式（例: "0900", "1430"）
  - 24時間表記
- **s** (number): 予約ステータス
  - **0**: 空きあり（予約可能）
  - **1**: 残りわずか
  - **2**: 満席
  - その他: スロットなし/利用不可

## ステータス判定ロジック

### 予約可能判定
```javascript
// 予約可能な条件
const isAvailable = slot.s === 0 || slot.s === 1;

// フィルタリング例
const hasAvailableSlots = pavilion.s && pavilion.s.some(slot => slot.s === 0 || slot.s === 1);
```

### 営業時間
- **営業時間**: 9:00 - 21:00（推定）
- **時間間隔**: 15分間隔
- **営業時間外**: データが空または表示制限

## パビリオンコード対応表

一部のパビリオンには短縮名が設定されている：

```javascript
const names = {
    'H1H9': ['日本館', ''],
    'HMH0': ['PASONA', ''],
    'I900': ['いのちの遊び場', ''],
    'C730': ['オーストラリア', ''],
    // ... その他多数
};
```

## 予約システム連携

### 予約URL生成
```javascript
const reservationUrl = `https://ticket.expo2025.or.jp/event_time/?id=${ticketIds}&event_id=${pavilionCode}&screen_id=108&lottery=5&entrance_date=${YYYYMMDD}`;
```

### 必要パラメータ
- **ticketIds**: チケットID（要事前設定）
- **pavilionCode**: パビリオンコード（cフィールド）
- **entrance_date**: 入場日（YYYYMMDD形式）

## 不明な要素・推測事項

### 1. API制限
- **レート制限**: 不明
- **認証**: 不要（パブリックAPI）
- **CORS**: 設定済み

### 2. データ更新頻度
- **更新間隔**: 不明（リアルタイム〜数分間隔と推定）
- **キャッシュ**: `no-cache`ヘッダー設定済み

### 3. 予約API（/api/add）
- **リクエスト形式**: 不明
- **必要パラメータ**: 不明
- **レスポンス形式**: 不明
- **認証要否**: 不明

### 4. エラーハンドリング
- **HTTPステータスコード**: 通常時200
- **エラー時の応答**: 不明
- **タイムアウト処理**: 要実装

### 5. 時間帯制限
- **営業時間外の挙動**: s配列が空になる
- **深夜・早朝のデータ**: 利用不可

## 監視システム実装時の注意点

1. **営業時間チェック**: 9:00-21:00の範囲でのみ監視
2. **ステータス変化検知**: `s === 0` または `s === 1` への変化を監視
3. **パビリオン名フィルタ**: `n === ""` は除外推奨
4. **エラーハンドリング**: API失敗時の再試行ロジック必須
5. **レート制限対応**: 適切な間隔での API 呼び出し（推奨: 30秒〜1分間隔）

## 追加調査が必要な項目

1. `/api/add` エンドポイントの詳細仕様
2. API のレート制限有無
3. 予約システムとの具体的な連携方法
4. エラー時のレスポンス内容
5. データ更新の正確な頻度